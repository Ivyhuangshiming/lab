<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»˜æœ¬æ•…äº‹æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        /* ç™»å½•ç•Œé¢ */
        .login-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 350px;
        }

        .login-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        /* Prestory æ•…äº‹èƒŒæ™¯ç•Œé¢ */
        .prestory-screen {
            display: none;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            position: relative;
        }

        .prestory-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prestory-title {
            font-size: 24px;
            color: #333;
            font-weight: bold;
        }

        .skip-prestory-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .skip-prestory-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .prestory-content {
            height: calc(100vh - 80px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .prestory-page {
            max-width: 800px;
            max-height: 600px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .prestory-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .prestory-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            align-items: center;
        }

        .prestory-progress {
            background: rgba(52, 152, 219, 0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
        }

        /* ä¸»ç•Œé¢ */
        .main-screen {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
        }

        .main-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .main-title {
            font-size: 36px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .user-info {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
        }

        .eras-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .era-card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .era-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .era-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .era-card.locked:hover {
            transform: none;
        }

        .era-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .era-title {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .era-progress {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .era-progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .era-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .era-status {
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 15px;
            display: inline-block;
        }

        .era-status.completed {
            background: #e8f5e8;
            color: #4caf50;
        }

        .era-status.current {
            background: #e3f2fd;
            color: #2196f3;
        }

        .era-status.locked {
            background: #f5f5f5;
            color: #999;
        }

        .lock-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            color: #ccc;
        }

        /* ç»˜æœ¬ç•Œé¢ */
        .storybook-screen {
            display: none;
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            position: relative;
        }

        .storybook-header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .storybook-info {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }

        .storybook-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 5px;
        }

        .storybook-day {
            color: #666;
            font-size: 16px;
        }

        .storybook-content {
            height: calc(100vh - 80px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .storybook-page {
            max-width: 800px;
            max-height: 600px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .page-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .page-indicator {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
        }

        /* æ¸¸æˆç•Œé¢é¢„ç•™ */
        .game-screen {
            display: none;
            width: 100%;
            height: 100%;
            background: #f0f2f5;
        }

        /* å·¥å…·å‡½æ•° */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .eras-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .main-title {
                font-size: 28px;
            }
            
            .era-card {
                padding: 20px 15px;
            }
        }

        /* æ–°å¢ï¼šæ¸¸æˆæŒ‰é’®æ ·å¼ */
        .game-trigger-btn {
            background: #fd79a8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            animation: gameButtonPulse 2s ease-in-out infinite;
        }

        .game-trigger-btn:hover {
            background: #e84393;
            transform: scale(1.05);
        }

        .game-trigger-btn:disabled {
            background: #ddd;
            color: #999;
            cursor: not-allowed;
            animation: none;
        }

        @keyframes gameButtonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* æ–°å¢ï¼šéŸ³é¢‘çŠ¶æ€æŒ‡ç¤ºæ ·å¼ */
        .audio-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }

        .audio-loading {
            color: #74b9ff;
        }

        .audio-playing {
            color: #00b894;
        }

        .audio-finished {
            color: #636e72;
        }

        /* ä¿®æ”¹ï¼šé¡µé¢æ§åˆ¶åŒºåŸŸæ ·å¼ */
        .page-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            align-items: center;
        }

        /* Prestoryå®Œæˆæç¤º */
        .prestory-complete-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .prestory-complete-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            animation: completeAppear 0.8s ease-out;
        }

        .prestory-complete-content h2 {
            color: #2d3436;
            margin-bottom: 20px;
            font-size: 28px;
        }

        .prestory-complete-content p {
            color: #636e72;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .enter-eras-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .enter-eras-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        @keyframes completeAppear {
            0% { 
                opacity: 0;
                transform: scale(0.5) translateY(-50px);
            }
            100% { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
    </style>
    <!-- å¼•å…¥æ¸¸æˆç»„ä»¶ -->
    <script src="js/whack-mole-game.js"></script>
    <script src="js/components.js"></script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div class="login-screen" id="loginScreen">
            <div class="login-box">
                <h1 class="login-title">ğŸ›ï¸ è¹¦è¹¦æ™‚å…‰ç©¿æ¢­è¨˜</h1>
                <form id="loginForm">
                    <div class="input-group">
                        <label for="username">ç”¨æˆ¶å</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="input-group">
                        <label for="password">å¯†ç¢¼</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="login-btn">é–‹å§‹å†’éšª</button>
                </form>
            </div>
        </div>

        <!-- Prestory æ•…äº‹èƒŒæ™¯ç•Œé¢ -->
        <div class="prestory-screen" id="prestoryScreen">
            <div class="prestory-header">
                <div class="prestory-title">ğŸ“œ æ•…äº‹èƒŒæ™¯</div>
                <button class="skip-prestory-btn" id="skipPrestoryBtn" hidden>è·³éä»‹ç´¹</button>
            </div>
            
            <div class="prestory-content">
                <div class="prestory-page">
                    <img id="prestoryImage" class="prestory-image" src="" alt="æ•…äº‹èƒŒæ™¯">
                    <div class="prestory-controls">
                        <button class="control-btn" id="prestoryPrevBtn">â†</button>
                        <div class="prestory-progress">
                            <span id="prestoryCurrentPage">1</span> / <span id="prestoryTotalPages">8</span>
                        </div>
                        <button class="control-btn" id="prestoryNextBtn">â†’</button>
                        
                        <!-- æ¸¸æˆè§¦å‘æŒ‰é’® -->
                        <button class="game-trigger-btn hidden" id="prestoryGameBtn" disabled>ğŸ® é–‹å§‹éŠæˆ²</button>
                        
                        <!-- éŸ³é¢‘çŠ¶æ€æŒ‡ç¤º -->
                        <div class="audio-status" id="prestoryAudioStatus">
                            <span id="prestoryAudioStatusText">æº–å‚™ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prestoryå®Œæˆé¢æ¿ -->
            <div class="prestory-complete-panel hidden" id="prestoryCompletePanel">
                <div class="prestory-complete-content">
                    <h2>ğŸ‰ æ­å–œä½ ï¼</h2>
                    <p>ç¾åœ¨ä½ å·²ç¶“äº†è§£äº†æ™‚å…‰ç©¿è¶Šçš„æ•…äº‹èƒŒæ™¯ï¼Œæº–å‚™å¥½é–‹å§‹ä½ çš„å†’éšªäº†å—ï¼Ÿé¸æ“‡ä¸€å€‹æ™‚ä»£ï¼Œé–‹å§‹ä½ çš„æ™‚å…‰ä¹‹æ—…å§ï¼</p>
                    <button class="enter-eras-btn" id="enterErasBtn">é€²å…¥æ™‚å…‰é¸æ“‡</button>
                </div>
            </div>
        </div>

        <!-- ä¸»ç•Œé¢ -->
        <div class="main-screen" id="mainScreen">
            <div class="main-header">
                <h1 class="main-title">ğŸ“š é¸æ“‡æ™‚å…‰</h1>
                <div class="user-info">æ­¡è¿å›ä¾†ï¼Œ<span id="currentUser">å†’éšªè€…</span>ï¼</div>
            </div>

            <div class="eras-container" id="erasContainer">
                <!-- æ—¶ä»£å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç»˜æœ¬ç•Œé¢ -->
        <div class="storybook-screen" id="storybookScreen">
            <div class="storybook-header">
                <button class="back-btn" id="backToMain">â† è¿”å›</button>
                <div class="storybook-info">
                    <div class="storybook-title" id="storybookTitle">æé¾æ™‚ä»£</div>
                    <div class="storybook-day" id="storybookDay">ç¬¬1å¤©</div>
                </div>
                <div style="width: 80px;"></div> <!-- å ä½ç¬¦ä¿æŒå±…ä¸­ -->
            </div>
            
            <div class="storybook-content">
                 <div class="storybook-page">
                    <!-- âš ï¸ å…³é”®ï¼šç¡®è®¤è¿™è¡Œå­˜åœ¨ -->
                    <img id="pageImage" class="page-image" src="" alt="æ•…äº‹é¡µé¢">
                    <div class="page-controls">
                        <button class="control-btn" id="prevBtn" hidden>â†</button>
                        <div class="page-indicator">
                            <span id="currentPage">1</span> / <span id="totalPages">10</span>
                        </div>
                        <button class="control-btn" id="nextBtn">â†’</button>
                        
                        <!-- æ–°å¢ï¼šæ¸¸æˆè§¦å‘æŒ‰é’® -->
                        <button class="game-trigger-btn hidden" id="gameTriggerBtn" disabled>ğŸ® é–‹å§‹éŠæˆ²</button>
                        
                        <!-- æ–°å¢ï¼šéŸ³é¢‘çŠ¶æ€æŒ‡ç¤º -->
                        <div class="audio-status" id="audioStatus">
                            <span id="audioStatusText">æº–å‚™ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div class="game-screen" id="gameScreen">
            <!-- æ¸¸æˆå†…å®¹å°†åœ¨åç»­å®ç° -->
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = '';
        let currentEra = null;
        let currentDay = 1;
        let currentPage = 1;
        let totalPages = 0;
        let currentAudio = null;
        let isAudioPlaying = false;
        let isAudioFinished = false;
        let currentStorybookData = null;

        // Prestory ç›¸å…³å˜é‡
        let prestoryCurrentPage = 1;
        let prestoryTotalPages = 0;
        let prestoryAudio = null;
        let isPrestoryAudioPlaying = false;
        let isPrestoryAudioFinished = false;
        let prestoryData = null;

        // ç¤ºä¾‹æ•°æ® - å®é™…åº”è¯¥ä»å¤–éƒ¨æ–‡ä»¶åŠ è½½
        const gameData = {
            eras: [
                {
                    id: 'ancient',
                    title: 'æé¾æ™‚ä»£',
                    icon: 'ğŸ›ï¸',
                    description: 'æ¢ç´¢æé¾çš„å¥§ç§˜',
                    progress: 0,
                    totalDays: 7,
                    unlocked: true
                },
                {
                    id: 'medieval',
                    title: 'çŸ³å™¨æ™‚ä»£',
                    icon: 'ğŸ°',
                    description: 'é«”é©—åŸå§‹äººçš„æ™ºæ…§',
                    progress: 0,
                    totalDays: 7,
                    unlocked: false
                },
                {
                    id: 'renaissance',
                    title: 'å†°æ²³ä¸–ç´€',
                    icon: 'ğŸ¨',
                    description: 'ç©¿è¶Šå†°æ²³ä¸–ç´€çš„æµªæ¼«',
                    progress: 0,
                    totalDays: 7,
                    unlocked: false
                },
                {
                    id: 'industrial',
                    title: 'å¤åŸƒåŠ',
                    icon: 'âš™ï¸',
                    description: 'é©šæ­æ–¼ç¥ç§˜çš„åœ‹åº¦',
                    progress: 0,
                    totalDays: 7,
                    unlocked: false
                },
                {
                    id: 'modern',
                    title: 'å¤§èˆªæµ·æ™‚ä»£',
                    icon: 'ğŸŒ†',
                    description: 'é§•èˆ¹å±•é–‹ä¸–ç•Œä¹‹æ—…å§',
                    progress: 0,
                    totalDays: 7,
                    unlocked: false
                },
                {
                    id: 'future',
                    title: 'ç§¦æœ',
                    icon: 'ğŸš€',
                    description: 'æ¢è¨ªç¥ç§˜çš„å¤ä¸­åœ‹',
                    progress: 0,
                    totalDays: 7,
                    unlocked: false
                }
            ]
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            setupEventListeners();
        });

        function initializeGame() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç™»å½•çŠ¶æ€
            const savedUser = localStorage.getItem('currentUser');
            const prestoryCompleted = localStorage.getItem('prestoryCompleted');
            
            if (savedUser) {
                currentUser = savedUser;
                if (prestoryCompleted === 'true') {
                    showMainScreen();
                } else {
                    showPrestoryScreen();
                }
            }
        }

        function setupEventListeners() {
            // ç™»å½•è¡¨å•
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // è¿”å›ä¸»ç•Œé¢
            document.getElementById('backToMain').addEventListener('click', showMainScreen);
            
            // ç»˜æœ¬ç¿»é¡µæ§åˆ¶
            document.getElementById('prevBtn').addEventListener('click', () => changePage(-1));
            document.getElementById('nextBtn').addEventListener('click', () => changePage(1));
            
            // Prestory æ§åˆ¶
            document.getElementById('prestoryPrevBtn').addEventListener('click', () => changePrestoryPage(-1));
            document.getElementById('prestoryNextBtn').addEventListener('click', () => changePrestoryPage(1));
            document.getElementById('skipPrestoryBtn').addEventListener('click', skipPrestory);
            document.getElementById('prestoryGameBtn').addEventListener('click', startPrestoryGame);
            document.getElementById('enterErasBtn').addEventListener('click', completePrestory);
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', handleKeyPress);

            // æ–°å¢ï¼šæ¸¸æˆè§¦å‘æŒ‰é’®
            document.getElementById('gameTriggerBtn').addEventListener('click', startMiniGame);
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // ç®€å•éªŒè¯ - å®é™…é¡¹ç›®ä¸­åº”è¯¥æœ‰çœŸå®çš„éªŒè¯é€»è¾‘
            if (username && password) {
                currentUser = username;
                localStorage.setItem('currentUser', username);
                
                // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆprestory
                const prestoryCompleted = localStorage.getItem('prestoryCompleted');
                if (prestoryCompleted === 'true') {
                    showMainScreen();
                } else {
                    showPrestoryScreen();
                }
            } else {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
            }
        }

        // ========================================
        // Prestory ç›¸å…³å‡½æ•°
        // ========================================

        function showPrestoryScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('storybookScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('prestoryScreen').style.display = 'block';
            
            loadPrestory();
        }

        function loadPrestory() {
            // åˆ›å»ºprestoryæ•°æ®
            prestoryTotalPages = 8; // prestoryæœ‰10é¡µ
            prestoryCurrentPage = 1;
            
            prestoryData = {
                id: 'prestory',
                title: 'æ•…äº‹èƒŒæ™¯',
                pages: []
            };

            // ç”Ÿæˆprestoryé¡µé¢æ•°æ®
            const prestoryGamePages = [1, 3, 5]; // åœ¨ç¬¬3ã€6ã€9é¡µæ’å…¥æ¸¸æˆ
            
            for (let page = 1; page <= prestoryTotalPages; page++) {
                const pageData = {
                    pageNumber: page,
                    image: `assets/images/prestory/page${page}.png`,
                    audio: `assets/audio/prestory/page${page}.mp3`,
                    hasGame: prestoryGamePages.includes(page)
                };
                prestoryData.pages.push(pageData);
            }
            
            updatePrestoryDisplay();
        }

        function updatePrestoryDisplay() {
            const prestoryImage = document.getElementById('prestoryImage');
            const imagePath = `assets/images/prestory/page${prestoryCurrentPage}.png`;
            console.log('Prestoryå›¾ç‰‡è·¯å¾„:', imagePath);
            prestoryImage.src = imagePath;
            
            document.getElementById('prestoryCurrentPage').textContent = prestoryCurrentPage;
            document.getElementById('prestoryTotalPages').textContent = prestoryTotalPages;
            
            // é‡ç½®éŸ³é¢‘çŠ¶æ€
            isPrestoryAudioFinished = false;
            updatePrestoryAudioStatus('loading', 'åŠ è¼‰ä¸­...');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updatePrestoryNavigationButtons();
            
            // æ’­æ”¾å¯¹åº”éŸ³é¢‘
            playPrestoryAudio();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºæ¸¸æˆæŒ‰é’®
            checkAndShowPrestoryGameButton();

            // æ–°å¢ï¼šå¦‚æœæ˜¯æœ€åä¸€é¡µä¸”æ²¡æœ‰æ¸¸æˆï¼Œè®¾ç½®è‡ªåŠ¨å®Œæˆæ£€æµ‹
            if (prestoryCurrentPage === prestoryTotalPages) {
                const currentPageData = getCurrentPrestoryPageData();
                if (!currentPageData || !currentPageData.hasGame) {
                    // å¦‚æœæœ€åä¸€é¡µæ²¡æœ‰æ¸¸æˆï¼Œåœ¨éŸ³é¢‘æ’­æ”¾å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºå®Œæˆé¢æ¿
                    // è¿™ä¸ªé€»è¾‘å·²ç»åœ¨ playPrestoryAudio() çš„ 'ended' äº‹ä»¶ä¸­å¤„ç†äº†
                }
            }
        }

        function changePrestoryPage(direction) {
            // å¦‚æœéŸ³é¢‘æ­£åœ¨æ’­æ”¾ä¸”æœªå®Œæˆï¼Œä¸å…è®¸ç¿»é¡µ
            if (isPrestoryAudioPlaying && !isPrestoryAudioFinished) {
                updatePrestoryAudioStatus('playing', 'è«‹ç­‰å¾…éŒ„éŸ³æ’­æ”¾å®Œ');
                return;
            }

            const newPage = prestoryCurrentPage + direction;
            if (newPage >= 1 && newPage <= prestoryTotalPages) {
                prestoryCurrentPage = newPage;
                updatePrestoryDisplay();
            } else if (newPage > prestoryTotalPages) {
                // åˆ°è¾¾æœ€åä¸€é¡µï¼Œæ˜¾ç¤ºå®Œæˆé¢æ¿
                showPrestoryCompletePanel();
            }
        }

        function playPrestoryAudio() {
            // åœæ­¢å½“å‰éŸ³é¢‘
            stopPrestoryAudio();
            
            // æ’­æ”¾æ–°éŸ³é¢‘
            const audioPath = `assets/audio/prestory/page${prestoryCurrentPage}.mp3`;
            prestoryAudio = new Audio(audioPath);
            
            isPrestoryAudioPlaying = true;
            isPrestoryAudioFinished = false;
            updatePrestoryAudioStatus('playing', 'æ’­æ”¾ä¸­...');
            updatePrestoryNavigationButtons();
            
            // éŸ³é¢‘åŠ è½½å®Œæˆ
            prestoryAudio.addEventListener('canplaythrough', () => {
                updatePrestoryAudioStatus('playing', 'æ’­æ”¾ä¸­...');
            });
            
            // éŸ³é¢‘æ’­æ”¾ç»“æŸ
            prestoryAudio.addEventListener('ended', () => {
                isPrestoryAudioPlaying = false;
                isPrestoryAudioFinished = true;
                updatePrestoryAudioStatus('finished', 'æ’­æ”¾å®Œæˆ');
                updatePrestoryNavigationButtons();
                
                // å¦‚æœè¿™ä¸€é¡µæœ‰æ¸¸æˆï¼Œå¯ç”¨æ¸¸æˆæŒ‰é’®
                const currentPageData = getCurrentPrestoryPageData();
                if (currentPageData && currentPageData.hasGame) {
                    const gameBtn = document.getElementById('prestoryGameBtn');
                    gameBtn.disabled = false;
                }

                    // æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºæœ€åä¸€é¡µï¼Œå¦‚æœæ˜¯åˆ™è‡ªåŠ¨æ˜¾ç¤ºå®Œæˆé¢æ¿
                if (prestoryCurrentPage === prestoryTotalPages) {
                    setTimeout(() => {
                        showPrestoryCompletePanel();
                    }, 2000); // å»¶è¿Ÿ2ç§’æ˜¾ç¤ºå®Œæˆé¢æ¿ï¼Œè®©ç”¨æˆ·çœ‹å®Œæœ€åä¸€é¡µ
                }
            });
            
            // éŸ³é¢‘æ’­æ”¾é”™è¯¯
            prestoryAudio.addEventListener('error', () => {
                isPrestoryAudioPlaying = false;
                isPrestoryAudioFinished = true;
                updatePrestoryAudioStatus('finished', 'æ— éŸ³é¢‘æ–‡ä»¶');
                updatePrestoryNavigationButtons();
                
                // å¦‚æœè¿™ä¸€é¡µæœ‰æ¸¸æˆï¼Œä¹Ÿå¯ç”¨æ¸¸æˆæŒ‰é’®
                const currentPageData = getCurrentPrestoryPageData();
                if (currentPageData && currentPageData.hasGame) {
                    const gameBtn = document.getElementById('prestoryGameBtn');
                    gameBtn.disabled = false;
                }
            });
            
            // å¼€å§‹æ’­æ”¾
            prestoryAudio.play().catch(e => {
                console.log('PrestoryéŸ³é¢‘æ’­æ”¾å¤±è´¥:', e);
                isPrestoryAudioPlaying = false;
                isPrestoryAudioFinished = true;
                updatePrestoryAudioStatus('finished', 'æ’­æ”¾å¤±è´¥');
                updatePrestoryNavigationButtons();
            });
        }

        function stopPrestoryAudio() {
            if (prestoryAudio) {
                prestoryAudio.pause();
                prestoryAudio.currentTime = 0;
                prestoryAudio = null;
            }
            isPrestoryAudioPlaying = false;
        }

        function updatePrestoryNavigationButtons() {
            const prevBtn = document.getElementById('prestoryPrevBtn');
            const nextBtn = document.getElementById('prestoryNextBtn');
            
            prevBtn.disabled = prestoryCurrentPage === 1;
            
            // åªæœ‰åœ¨éŸ³é¢‘æ’­æ”¾å®Œæˆåæ‰èƒ½ç¿»é¡µ
            if (isPrestoryAudioPlaying && !isPrestoryAudioFinished) {
                nextBtn.disabled = true;
                nextBtn.title = 'è¯·ç­‰å¾…è¯­éŸ³æ’­æ”¾å®Œæˆ';
                nextBtn.textContent = 'â†’';
            } else {
                nextBtn.disabled = false;
                nextBtn.title = '';
                
                // å¦‚æœæ˜¯æœ€åä¸€é¡µï¼Œæ”¹å˜æŒ‰é’®æ–‡å­—
                if (prestoryCurrentPage === prestoryTotalPages) {
                    nextBtn.textContent = 'å®Œæˆ';
                    nextBtn.style.background = '#00b894'; // æ”¹å˜é¢œè‰²æç¤º
                } else {
                    nextBtn.textContent = 'â†’';
                    nextBtn.style.background = '#667eea'; // æ¢å¤åŸè‰²
                }
            }
        }

        function updatePrestoryAudioStatus(status, text) {
            const statusElement = document.getElementById('prestoryAudioStatus');
            const statusText = document.getElementById('prestoryAudioStatusText');
            
            statusElement.className = `audio-status audio-${status}`;
            statusText.textContent = text;
        }

        function getCurrentPrestoryPageData() {
            if (!prestoryData || !prestoryData.pages) {
                return null;
            }
            return prestoryData.pages[prestoryCurrentPage - 1];
        }

        function checkAndShowPrestoryGameButton() {
            const gameBtn = document.getElementById('prestoryGameBtn');
            const currentPageData = getCurrentPrestoryPageData();
            
            if (currentPageData && currentPageData.hasGame) {
                gameBtn.classList.remove('hidden');
                gameBtn.disabled = true; // ç­‰å¾…éŸ³é¢‘æ’­æ”¾å®Œæˆ
            } else {
                gameBtn.classList.add('hidden');
            }
        }

        function startPrestoryGame() {
            const currentPageData = getCurrentPrestoryPageData();
            if (!currentPageData || !currentPageData.hasGame) {
                return;
            }

            // è·å–prestoryæ¸¸æˆæ•°æ®
            const gameData = window.GameDataGenerator ? 
                window.GameDataGenerator.getGameByPage('prestory', 1, prestoryCurrentPage) :
                getDefaultGameData();

            // éšè—prestoryç•Œé¢
            document.getElementById('prestoryScreen').style.display = 'none';
            
            // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
            const gameScreen = document.getElementById('gameScreen');
            gameScreen.style.display = 'block';
            gameScreen.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„æ¸¸æˆ

            // åˆ›å»ºæ‰“åœ°é¼ æ¸¸æˆ
            const whackMoleGame = new (window.WhackMoleGame || MockWhackMoleGame)(
                gameScreen,
                gameData,
                {
                    onComplete: (results) => {
                        console.log('Prestoryæ¸¸æˆå®Œæˆ:', results);
                        // è¿”å›prestory
                        returnToPrestory();
                    },
                    onExit: () => {
                        // è¿”å›prestory
                        returnToPrestory();
                    }
                }
            );
        }

        function returnToPrestory() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('prestoryScreen').style.display = 'block';
        }

        function skipPrestory() {
            if (confirm('ç¡®å®šè¦è·³è¿‡æ•…äº‹èƒŒæ™¯å—ï¼Ÿä½ å¯ä»¥éšæ—¶å›æ¥æŸ¥çœ‹ã€‚')) {
                completePrestory();
            }
        }

        function showPrestoryCompletePanel() {
            document.getElementById('prestoryCompletePanel').classList.remove('hidden');
        }

        function completePrestory() {
            // æ ‡è®°prestoryå·²å®Œæˆ
            localStorage.setItem('prestoryCompleted', 'true');
            
            // åœæ­¢éŸ³é¢‘
            stopPrestoryAudio();
            
            // è¿›å…¥ä¸»ç•Œé¢
            showMainScreen();
        }

        // ========================================
        // ä¸»ç•Œé¢ç›¸å…³å‡½æ•°
        // ========================================

        function showMainScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('prestoryScreen').style.display = 'none';
            document.getElementById('storybookScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            
            document.getElementById('currentUser').textContent = currentUser;
            renderEras();
        }

        function renderEras() {
            const container = document.getElementById('erasContainer');
            container.innerHTML = '';
            
            gameData.eras.forEach(era => {
                const eraCard = createEraCard(era);
                container.appendChild(eraCard);
            });
        }

        function createEraCard(era) {
            const card = document.createElement('div');
            card.className = `era-card ${era.unlocked ? '' : 'locked'}`;
            card.setAttribute('data-era-id', era.id);
            
            const progressPercent = (era.progress / era.totalDays) * 100;
            let statusClass = 'locked';
            let statusText = 'ğŸ”’ æœªè§£é–';
            
            if (era.unlocked) {
                if (era.progress === era.totalDays) {
                    statusClass = 'completed';
                    statusText = 'âœ… å·²å®Œæˆ';
                } else {
                    statusClass = 'current';
                    statusText = `ğŸ“– é€²è¡Œä¸­ ${era.progress}/${era.totalDays}`;
                }
            }
            
            card.innerHTML = `
                ${!era.unlocked ? '<div class="lock-icon">ğŸ”’</div>' : ''}
                <div class="era-icon">${era.icon}</div>
                <div class="era-title">${era.title}</div>
                <div class="era-progress">${era.description}</div>
                <div class="era-progress-bar">
                    <div class="era-progress-fill" style="width: ${progressPercent}%"></div>
                </div>
                <div class="era-status ${statusClass}">${statusText}</div>
            `;
            
            if (era.unlocked) {
                card.addEventListener('click', () => enterEra(era));
            }
            
            return card;
        }

        function enterEra(era) {
            currentEra = era;
            currentDay = era.progress + 1; // è¿›å…¥ä¸‹ä¸€å¤©
            if (currentDay > era.totalDays) currentDay = era.totalDays; // å·²å®Œæˆçš„æ—¶ä»£
            
            showStorybookScreen();
        }

        function showStorybookScreen() {
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('storybookScreen').style.display = 'block';
            
            document.getElementById('storybookTitle').textContent = currentEra.title;
            document.getElementById('storybookDay').textContent = `ç¬¬${currentDay}å¤©`;
            
            loadStorybook();
        }

        function loadStorybook() {
            // è¿™é‡Œåº”è¯¥æ ¹æ®currentEra.idå’ŒcurrentDayåŠ è½½å¯¹åº”çš„ç»˜æœ¬æ•°æ®
            // ç¤ºä¾‹ï¼šå‡è®¾æ¯å¤©æœ‰12é¡µç»˜æœ¬
            totalPages = 12;
            currentPage = 1;
            
            // åˆ›å»ºç»˜æœ¬æ•°æ®
            currentStorybookData = {
                eraId: currentEra.id,
                day: currentDay,
                title: `${currentEra.title} - ç¬¬${currentDay}å¤©`,
                pages: []
            };

            // ç”Ÿæˆé¡µé¢æ•°æ®
            const gameInsertPages = [2, 3, 5]; // åœ¨è¿™äº›é¡µé¢æ’å…¥æ¸¸æˆ
            
            for (let page = 1; page <= totalPages; page++) {
                const pageData = {
                    pageNumber: page,
                    image: `assets/images/${currentEra.id}/day${currentDay}/page${page}.png`,
                    audio: `assets/audio/${currentEra.id}/day${currentDay}/page${page}.mp3`,
                    hasGame: gameInsertPages.includes(page)
                };
                currentStorybookData.pages.push(pageData);
            }
            
            updatePageDisplay();
        }

        function updatePageDisplay() {
            const pageImage = document.getElementById('pageImage');
            const imagePath = `assets/images/${currentEra.id}/day${currentDay}/page${currentPage}.png`;
            console.log(imagePath);
            pageImage.src = imagePath;
            
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            // é‡ç½®éŸ³é¢‘çŠ¶æ€
            isAudioFinished = false;
            updateAudioStatus('loading', 'åŠ è½½ä¸­...');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateNavigationButtons();
            
            // æ’­æ”¾å¯¹åº”éŸ³é¢‘
            playPageAudio();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºæ¸¸æˆæŒ‰é’®
            checkAndShowGameButton();
        }

        function changePage(direction) {
            // å¦‚æœéŸ³é¢‘æ­£åœ¨æ’­æ”¾ä¸”æœªå®Œæˆï¼Œä¸å…è®¸ç¿»é¡µ
            if (isAudioPlaying && !isAudioFinished) {
                updateAudioStatus('playing', 'è¯·ç­‰å¾…è¯­éŸ³æ’­æ”¾å®Œæˆ');
                return;
            }

            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updatePageDisplay();
            }
        }

        function playPageAudio() {
            // åœæ­¢å½“å‰éŸ³é¢‘
            stopAllAudio();
            
            // æ’­æ”¾æ–°éŸ³é¢‘
            const audioPath = `assets/audio/${currentEra.id}/day${currentDay}/page${currentPage}.mp3`;
            currentAudio = new Audio(audioPath);
            
            isAudioPlaying = true;
            isAudioFinished = false;
            updateAudioStatus('playing', 'æ’­æ”¾ä¸­...');
            updateNavigationButtons();
            
            // éŸ³é¢‘åŠ è½½å®Œæˆ
            currentAudio.addEventListener('canplaythrough', () => {
                updateAudioStatus('playing', 'æ’­æ”¾ä¸­...');
            });
            
            // éŸ³é¢‘æ’­æ”¾ç»“æŸ
            currentAudio.addEventListener('ended', () => {
                isAudioPlaying = false;
                isAudioFinished = true;
                updateAudioStatus('finished', 'æ’­æ”¾å®Œæˆ');
                updateNavigationButtons();
                
                // å¦‚æœè¿™ä¸€é¡µæœ‰æ¸¸æˆï¼Œå¯ç”¨æ¸¸æˆæŒ‰é’®
                const currentPageData = getCurrentPageData();
                if (currentPageData && currentPageData.hasGame) {
                    const gameBtn = document.getElementById('gameTriggerBtn');
                    gameBtn.disabled = false;
                }
            });
            
            // éŸ³é¢‘æ’­æ”¾é”™è¯¯
            currentAudio.addEventListener('error', () => {
                isAudioPlaying = false;
                isAudioFinished = true;
                updateAudioStatus('finished', 'æ— éŸ³é¢‘æ–‡ä»¶');
                updateNavigationButtons();
                
                // å¦‚æœè¿™ä¸€é¡µæœ‰æ¸¸æˆï¼Œä¹Ÿå¯ç”¨æ¸¸æˆæŒ‰é’®
                const currentPageData = getCurrentPageData();
                if (currentPageData && currentPageData.hasGame) {
                    const gameBtn = document.getElementById('gameTriggerBtn');
                    gameBtn.disabled = false;
                }
            });
            
            // å¼€å§‹æ’­æ”¾
            currentAudio.play().catch(e => {
                console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e);
                isAudioPlaying = false;
                isAudioFinished = true;
                updateAudioStatus('finished', 'æ’­æ”¾å¤±è´¥');
                updateNavigationButtons();
            });
        }

        function handleKeyPress(e) {
            if (document.getElementById('storybookScreen').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    changePage(-1);
                } else if (e.key === 'ArrowRight') {
                    changePage(1);
                } else if (e.key === 'Escape') {
                    showMainScreen();
                } else if (e.key === 'Enter' || e.key === ' ') {
                    // æ–°å¢ï¼šç©ºæ ¼é”®æˆ–å›è½¦é”®è§¦å‘æ¸¸æˆ
                    const gameBtn = document.getElementById('gameTriggerBtn');
                    if (!gameBtn.classList.contains('hidden') && !gameBtn.disabled) {
                        startMiniGame();
                    }
                }
            } else if (document.getElementById('prestoryScreen').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    changePrestoryPage(-1);
                } else if (e.key === 'ArrowRight') {
                    changePrestoryPage(1);
                } else if (e.key === 'Escape') {
                    skipPrestory();
                } else if (e.key === 'Enter' || e.key === ' ') {
                    // ç©ºæ ¼é”®æˆ–å›è½¦é”®è§¦å‘prestoryæ¸¸æˆ
                    const gameBtn = document.getElementById('prestoryGameBtn');
                    if (!gameBtn.classList.contains('hidden') && !gameBtn.disabled) {
                        startPrestoryGame();
                    }
                }
            }
        }

        function stopAllAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
            isAudioPlaying = false;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentPage === 1;
            
            // åªæœ‰åœ¨éŸ³é¢‘æ’­æ”¾å®Œæˆåæ‰èƒ½ç¿»é¡µ
            if (isAudioPlaying && !isAudioFinished) {
                nextBtn.disabled = true;
                nextBtn.title = 'è¯·ç­‰å¾…è¯­éŸ³æ’­æ”¾å®Œæˆ';
            } else {
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.title = '';
            }
        }

        function updateAudioStatus(status, text) {
            const statusElement = document.getElementById('audioStatus');
            const statusText = document.getElementById('audioStatusText');
            
            statusElement.className = `audio-status audio-${status}`;
            statusText.textContent = text;
        }

        function getCurrentPageData() {
            if (!currentStorybookData || !currentStorybookData.pages) {
                return null;
            }
            return currentStorybookData.pages[currentPage - 1];
        }

        function checkAndShowGameButton() {
            const gameBtn = document.getElementById('gameTriggerBtn');
            const currentPageData = getCurrentPageData();
            
            if (currentPageData && currentPageData.hasGame) {
                gameBtn.classList.remove('hidden');
                gameBtn.disabled = true; // ç­‰å¾…éŸ³é¢‘æ’­æ”¾å®Œæˆ
            } else {
                gameBtn.classList.add('hidden');
            }
        }

        function startMiniGame() {
            const currentPageData = getCurrentPageData();
            if (!currentPageData || !currentPageData.hasGame) {
                return;
            }

            // è·å–æ¸¸æˆæ•°æ®
            const gameData = window.GameDataGenerator ? 
                window.GameDataGenerator.getGameByPage(currentEra.id, currentDay, currentPage) :
                getDefaultGameData();

            // éšè—ç»˜æœ¬ç•Œé¢
            document.getElementById('storybookScreen').style.display = 'none';
            
            // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
            const gameScreen = document.getElementById('gameScreen');
            gameScreen.style.display = 'block';
            gameScreen.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„æ¸¸æˆ

            // åˆ›å»ºæ‰“åœ°é¼ æ¸¸æˆ
            const whackMoleGame = new (window.WhackMoleGame || MockWhackMoleGame)(
                gameScreen,
                gameData,
                {
                    onComplete: (results) => {
                        console.log('éŠæˆ²å®Œæˆ:', results);
                        // è¿”å›ç»˜æœ¬
                        returnToStorybook();
                        
                        // æ›´æ–°ç”¨æˆ·è¿›åº¦
                        updateGameProgress(results);
                    },
                    onExit: () => {
                        // è¿”å›ç»˜æœ¬
                        returnToStorybook();
                    }
                }
            );
        }

        function returnToStorybook() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('storybookScreen').style.display = 'block';
        }

        function updateGameProgress(results) {
            // è¿™é‡Œåº”è¯¥ä¿å­˜æ¸¸æˆæˆç»©åˆ°ç”¨æˆ·è¿›åº¦
            console.log('ä¿å­˜æ¸¸æˆæˆç»©:', results);
            // å¯ä»¥è°ƒç”¨ GameData.manager.updateUserProgress() æ¥ä¿å­˜è¿›åº¦
        }

        function getDefaultGameData() {
            // é»˜è®¤æ¸¸æˆæ•°æ®ï¼Œå½“GameDataGeneratorä¸å¯ç”¨æ—¶ä½¿ç”¨
            return {
                id: 'default_whack_mole',
                type: 'whack_mole',
                title: 'è«‹æ‰¾å‡ºåŒéŸ³ä¸åŒç¾©çš„è©èª',
                questions: [
                    {
                        id: 1,
                        prompt: 'é‚£å€‹é®ä½çš„å­—è·Ÿå…¶ä»–å­—æ„æ€ä¸ä¸€æ¨£å‘¢ï¼Ÿ',
                        words: [
                            { text: 'é‰›*' },
                            { text: '*å¾—äº†' },
                            { text: '*å¿… ' },
                            { text: 'å¿*ä½' }
                        ],
                        correctAnswer: 0
                    },
                    {
                        id: 2,
                        prompt: 'é‚£å€‹é®ä½çš„å­—è·Ÿå…¶ä»–å­—æ„æ€ä¸ä¸€æ¨£å‘¢ï¼Ÿ',
                        words: [
                            { text: 'é‰›*' },
                            { text: '*å¾—äº†' },
                            { text: '*å¿… ' },
                            { text: 'å¿*ä½' }
                        ],
                        correctAnswer: 0
                    },
                    {
                        id: 3,
                       prompt: 'é‚£å€‹é®ä½çš„å­—è·Ÿå…¶ä»–å­—æ„æ€ä¸ä¸€æ¨£å‘¢ï¼Ÿ',
                        words: [
                            { text: 'é‰›*' },
                            { text: '*å¾—äº†' },
                            { text: '*å¿… ' },
                            { text: 'å¿*ä½' }
                        ],
                        correctAnswer: 1
                    },
                    {
                        prompt: 'é‚£å€‹é®ä½çš„å­—è·Ÿå…¶ä»–å­—æ„æ€ä¸ä¸€æ¨£å‘¢ï¼Ÿ',
                        words: [
                            { text: 'é‰›*' },
                            { text: '*å¾—äº†' },
                            { text: '*å¿… ' },
                            { text: 'å¿*ä½' }
                        ],
                        correctAnswer: 0
                    },
                    {
                        prompt: 'é‚£å€‹é®ä½çš„å­—è·Ÿå…¶ä»–å­—æ„æ€ä¸ä¸€æ¨£å‘¢ï¼Ÿ',
                        words: [
                            { text: 'é‰›*' },
                            { text: '*å¾—äº†' },
                            { text: '*å¿… ' },
                            { text: 'å¿*ä½' }
                        ],
                        correctAnswer: 0
                    }
                ]
            };
        }

        // ç®€å•çš„æ¨¡æ‹Ÿæ¸¸æˆç±»ï¼ˆå¦‚æœWhackMoleGameä¸å¯ç”¨ï¼‰
        class MockWhackMoleGame {
            constructor(container, gameData, callbacks) {
                this.container = container;
                this.callbacks = callbacks;
                this.init();
            }

            init() {
                this.container.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #74b9ff; color: white; text-align: center; font-family: Arial, sans-serif;">
                        <div>
                            <h2>ğŸ® æ‰“åœ°é¼ æ¸¸æˆ</h2>
                            <p>æ¸¸æˆç»„ä»¶åŠ è½½ä¸­...</p>
                            <button onclick="this.complete()" style="padding: 15px 30px; background: white; border: none; border-radius: 25px; cursor: pointer; margin-top: 20px;">å®Œæˆæ¸¸æˆ</button>
                        </div>
                    </div>
                `;

                // ç»‘å®šå®ŒæˆæŒ‰é’®äº‹ä»¶
                this.container.querySelector('button').onclick = () => {
                    if (this.callbacks.onComplete) {
                        this.callbacks.onComplete({
                            score: 50,
                            totalQuestions: 5,
                            correctAnswers: 5
                        });
                    }
                };
            }
        }

        // ä¿®æ”¹ç°æœ‰çš„checkForGameå‡½æ•°
        function checkForGame() {
            // å·²è¢«checkAndShowGameButtonæ›¿ä»£ï¼Œä¿ç•™ä»¥é˜²å…¶ä»–åœ°æ–¹è°ƒç”¨
            checkAndShowGameButton();
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', function() {
            stopAllAudio();
            stopPrestoryAudio();
        });

    </script>
</body>
</html>